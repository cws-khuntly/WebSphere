INSTALL WAS
/opt/IBM/IIM/eclipse/tools/imcl input ${HOME}/workspace/responsefiles/IBM/WAS/was-base.xml -nosplash -acceptLicense -showProgress
/opt/IBM/IIM/eclipse/tools/imcl input ${HOME}/workspace/responsefiles/IBM/WAS/was-fp018.xml -nosplash -acceptLicense -showProgress

INSTALL PORTAL
/opt/IBM/IIM/eclipse/tools/imcl input ${HOME}/workspace/responsefiles/HCL/WPS/wps85-base.xml -nosplash -acceptLicense -showProgress
/opt/IBM/IIM/eclipse/tools/imcl input ${HOME}/workspace/responsefiles/HCL/WPS/wps-cf224.xml -nosplash -acceptLicense -showProgress

vi /opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/properties/wkplc.properties; chmod 600 /opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/properties/wkplc.properties
vi /opt/IBM/WebSphere/AppServer/profiles/cw_profile/properties/soap.client.props; chmod 600 /opt/IBM/WebSphere/AppServer/profiles/cw_profile/properties/soap.client.props
vi /opt/IBM/WebSphere/profiles/wp_profile/properties/soap.client.props; chmod 600 /opt/IBM/WebSphere/profiles/wp_profile/properties/soap.client.props

/opt/IBM/WebSphere/AppServer/bin/PropFilePasswordEncoder.sh \
    /opt/IBM/WebSphere/AppServer/profiles/cw_profile/properties/soap.client.props \
    com.ibm.SOAP.loginPassword

/opt/IBM/WebSphere/AppServer/bin/PropFilePasswordEncoder.sh \
    /opt/IBM/WebSphere/profiles/wp_profile/properties/soap.client.props \
    com.ibm.SOAP.loginPassword

/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/stopServer.sh server1
/opt/IBM/WebSphere/profiles/wp_profile/bin/stopServer.sh WebSphere_Portal

export install_95=false; /opt/IBM/WebSphere/profiles/wp_profile/PortalServer/bin/applyCF.sh

/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/stopServer.sh server1
/opt/IBM/WebSphere/profiles/wp_profile/bin/stopServer.sh WebSphere_Portal

/opt/IBM/IIM/eclipse/tools/imcl input ${HOME}/workspace/responsefiles/HCL/WPS/wps95-base.xml -nosplash -acceptLicense -showProgress

/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/stopServer.sh server1
/opt/IBM/WebSphere/profiles/wp_profile/bin/stopServer.sh WebSphere_Portal

UPDATE WAS TO FP22
/opt/IBM/IIM/eclipse/tools/imcl input ${HOME}/workspace/responsefiles/IBM/WAS/was-fp022.xml -nosplash -acceptLicense -showProgress

CHECKPOINT

Deployment Manager:
mkdir -pv /opt/IBM/backups;

/opt/IBM/WebSphere/profiles/dmgr01/bin/stopManager.sh

rm -rf /opt/IBM/WebSphere/profiles/dmgr01/temp/*
rm -rf /opt/IBM/WebSphere/profiles/dmgr01/wstemp/*

/opt/IBM/WebSphere/profiles/dmgr01/bin/clearClassCache.sh
/opt/IBM/WebSphere/profiles/dmgr01/bin/osgiCfgInit.sh

/opt/IBM/WebSphere/AppServer/bin/manageprofiles.sh -backupProfile -profileName dmgr01 -backupFile /opt/IBM/backups/dmgr01-PostInstall-backup.$(date +"%d-%m-%Y_%H:%M:%S");

tar -C /opt/IBM -cvf - ./WebSphere | gzip > /opt/IBM/backups/WebSphere-full-backup-PostInstall-$(date +"%d-%m-%Y_%H:%M:%S").tar.gz

/opt/IBM/WebSphere/profiles/dmgr01/bin/startManager.sh

Portal Server:
mkdir -pv /opt/IBM/backups;

/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/stopServer.sh server1
/opt/IBM/WebSphere/profiles/wp_profile/bin/stopServer.sh WebSphere_Portal

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    cleanup-work-dir

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    delete-passwords

rm -rf /opt/IBM/WebSphere/profiles/wp_profile/temp/*
rm -rf /opt/IBM/WebSphere/profiles/wp_profile/wstemp/*

/opt/IBM/WebSphere/profiles/wp_profile/bin/clearClassCache.sh
/opt/IBM/WebSphere/profiles/wp_profile/bin/osgiCfgInit.sh

rm -rf /opt/IBM/WebSphere/AppServer/profiles/cw_profile/temp/*
rm -rf /opt/IBM/WebSphere/AppServer/profiles/cw_profile/wstemp/*

/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/clearClassCache.sh
/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/osgiCfgInit.sh

for profile in cw_profile wp_profile; do
    /opt/IBM/WebSphere/AppServer/bin/manageprofiles.sh -backupProfile -profileName ${profile} -backupFile /opt/IBM/backups/${profile}-PostInstall-backup.$(date +"%d-%m-%Y_%H:%M:%S");
done

tar -C /opt/IBM -cvf - ./WebSphere | gzip > /opt/IBM/backups/WebSphere-full-backup-PostInstall-$(date +"%d-%m-%Y_%H:%M:%S").tar.gz

/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/startServer.sh server1
/opt/IBM/WebSphere/profiles/wp_profile/bin/startServer.sh WebSphere_Portal

FEDERATE AND CLUSTER

REMEMBER TO ADD PASSWORDS BACK TO wkplc.properties

vi /opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/properties/wkplc_dbdomain.properties; chmod 600 /opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/properties/wkplc_dbdomain.properties

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    -DWasRemoteHostName=${DMGR_HOST_NAME} -DWasSoapPort=8879  \
    -DDmgrNodeName=dmgrNode01 -DDmgrCellName=dmgrCell01 -DdmgrProfilePath=/opt/IBM/WebSphere/profiles/dmgr01 -DisRemoteDmgr=true \
    -DPrimaryNode=true add-node

Update wkplc_dbdomain.properties, adding release.DbUser and release.DbPassword
Update /opt/IBM/WebSphere/AppServer/bin/wsadmin.sh
 - change PERF_JVM_OPTIONS, change -Xms256m to -Xms1024m and -Xmx256m to -Xmx1024m

sed -i.bk "s/-Xms256m/-Xms4096m/g" "s/-Xmx256m/-Xmx4096m/g" /opt/IBM/WebSphere/AppServer/bin/wsadmin.sh

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    -DClusterName=PortalCluster \
    -DWasRemoteHostName=${DMGR_HOST_NAME} -DWasSoapPort=8879  \
    -DPrimaryNode=true cluster-node-config-post-federation

Update /opt/IBM/WebSphere/PortalServer/search/wp.search.service/config/includes/wp.search.service_cfg.xml, changing all instances of failonerror="yes" to failonerror="no"
Save and close the file

sed -i.bk "s/failonerror=\"yes\"/failonerror=\"no\"/g" /opt/IBM/WebSphere/PortalServer/search/wp.search.service/config/includes/wp.search.service_cfg.xml

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    -DClusterName=PortalCluster \
    -DWasRemoteHostName=${DMGR_HOST_NAME} -DWasSoapPort=8879  \
    -DPrimaryNode=true cluster-node-config-cluster-setup

Fix the derby installaton
/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    validate-database-driver connect-database-driver

CHECKPOINT

Deployment Manager:
mkdir -pv /opt/IBM/backups

/opt/IBM/WebSphere/profiles/dmgr01/bin/stopManager.sh

rm -rf /opt/IBM/WebSphere/profiles/dmgr01/temp/*
rm -rf /opt/IBM/WebSphere/profiles/dmgr01/wstemp/*

/opt/IBM/WebSphere/profiles/dmgr01/bin/clearClassCache.sh
/opt/IBM/WebSphere/profiles/dmgr01/bin/osgiCfgInit.sh

/opt/IBM/WebSphere/AppServer/bin/manageprofiles.sh -backupProfile -profileName dmgr01 -backupFile /opt/IBM/backups/dmgr01-backup-PostDerbyReinstall-$(date +"%d-%m-%Y_%H:%M:%S");
cd /opt/IBM
zip -r backups/WebSphere-full-backup-PostPortalFederation-17-02-2025_18:41:00.zip WebSphere/

tar -C /opt/IBM -cvf - ./WebSphere | gzip > /opt/IBM/backups/WebSphere-full-backup-PostDerbyReinstall-$(date +"%d-%m-%Y_%H:%M:%S").tar.gz

/opt/IBM/WebSphere/profiles/dmgr01/bin/startManager.sh

Portal node:
mkdir -pv /opt/IBM/backups;

/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/stopServer.sh server1
/opt/IBM/WebSphere/profiles/wp_profile/bin/stopServer.sh WebSphere_Portal
/opt/IBM/WebSphere/profiles/wp_profile/bin/stopNode.sh

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    cleanup-work-dir

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    delete-passwords

rm -rf /opt/IBM/WebSphere/profiles/wp_profile/temp/*
rm -rf /opt/IBM/WebSphere/profiles/wp_profile/wstemp/*

/opt/IBM/WebSphere/profiles/wp_profile/bin/clearClassCache.sh
/opt/IBM/WebSphere/profiles/wp_profile/bin/osgiCfgInit.sh

rm -rf /opt/IBM/WebSphere/AppServer/profiles/cw_profile/temp/*
rm -rf /opt/IBM/WebSphere/AppServer/profiles/cw_profile/wstemp/*

/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/clearClassCache.sh
/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/osgiCfgInit.sh

for profile in cw_profile wp_profile; do
    /opt/IBM/WebSphere/AppServer/bin/manageprofiles.sh -backupProfile -profileName ${profile} -backupFile /opt/IBM/backups/${profile}-PostDerbyReinstall-backup.$(date +"%d-%m-%Y_%H:%M:%S");
done

tar -C /opt/IBM -cvf - ./WebSphere | gzip > /opt/IBM/backups/WebSphere-full-backup-PostDerbyReinstall-$(date +"%d-%m-%Y_%H:%M:%S").tar.gz

/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/startServer.sh server1
/opt/IBM/WebSphere/profiles/wp_profile/bin/startNode.sh
/opt/IBM/WebSphere/profiles/wp_profile/bin/startServer.sh WebSphere_Portal

CHANGE PORTAL URI

REMEMBER TO ADD PASSWORDS BACK TO wkplc.properties

vi /opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/properties/wkplc.properties; chmod 600 /opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/properties/wkplc.properties

Update ConfigEngine wkplc.properties:
vi /opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/properties/wkplc.properties

Change the value for WasRemoteHost, setting to deployment manager:
 - Current: WasRemoteHost=bppad01vr.bcbsma.com
 - New: WasRemoteHost=${DMGR_HOST_NAME}

sed -i.bk "s/WasRemoteHost=bppad01vr.bcbsma.com/WasRemoteHost=${DMGR_HOST_NAME}/g" /opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/properties/wkplc.properties

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    -DValidationWpsContextRoot=MyPortal -DValidationWpsDefaultHome=portal \
    -DValidationWpsPersonalizedHome=myportal -DValidationWsrpContextRoot=MyPortal/wsrp \
    validate-context-root

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    stop-portal-server

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    -DWsrpContextRoot=MyPortal/wsrp -DWpsContextRoot=MyPortal \
    -DWpsDefaultHome=portal -DWpsPersonalizedHome=myportal \
    modify-servlet-path modify-servlet-path-portlets

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    stop-portal-server

Update wkplc.properties, changing WpsContextRoot:
 - Current: WpsContextRoot=wps
 - New: WpsContextRoot=MyPortal

sed -i.bk "s/WpsContextRoot=wps/WpsContextRoot=MyPortal/g" /opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/properties/wkplc.properties

Save and close the file

/opt/IBM/WebSphere/profiles/wp_profile/bin/stopNode.sh
/opt/IBM/WebSphere/profiles/wp_profile/bin/syncNode.sh ${DMGR_HOST_NAME} 8879 -restart

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    start-portal-server

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    configure-nav-stateinfo-urls

Web Server:

Execute the following on the deployment manager:
/opt/IBM/WebSphere/profiles/dmgr01/bin/wsadmin.sh -lang jython

Enter the following:

AdminTask.createUnmanagedNode('[-nodeName webserverNode -hostName webserverhost.domain.com -nodeOperatingSystem linux]')
AdminConfig.save()
AdminNodeManagement.syncActiveNodes()

/opt/IBM/WebSphere/profiles/dmgr01/bin/wsadmin.sh -lang jython -f ${HOME}/workspace/WebSphere/AppServer/wsadmin/syncNodes.py

Execute the following on the IHS server:

/opt/IBM/WebSphere/Toolbox/WCT/wctcmd.sh -tool pct -importDefinitionLocation \
    -defLocPathname /opt/IBM/WebSphere/Plugins -defLocName IHSPlugins-v9.0.5.22
/opt/IBM/WebSphere/Toolbox/WCT/wctcmd.sh -tool pct \
    -defLocPathname /opt/IBM/WebSphere/Plugins -defLocName "IHSPlugins-v9.0.5.22" \
    -createDefinition -response ${HOME}/workspace/WebSphere/IHS/responsefiles/pct-responsefile.txt

Change permissions:
chmod 700 /opt/IBM/WebSphere/Plugins/bin/configurewp_profileIHS.sh

Edit the resultant file:

vi /opt/IBM/WebSphere/Plugins/bin/configurewp_profileIHS.sh

Update the last line in the file:
 - Current: /bin/wsadmin.sh ...
 - New: ${USER_INSTALL_ROOT}/bin/wsadmin.sh ...

Do not change anything other than the call to wsadmin.sh

Copy /opt/IBM/WebSphere/Plugins/bin/configurewp_profileIHS.sh to the deployment manager into /opt/IBM/WebSphere/profiles/dmgr01/bin/configurewp_profileIHS.sh
chmod 700 /opt/IBM/WebSphere/profiles/dmgr01/bin/configurewp_profileIHS.sh

Run the script:

/opt/IBM/WebSphere/profiles/dmgr01/bin/configurewp_profileIHS.sh

Resync:

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    stop-portal-server

/opt/IBM/WebSphere/profiles/wp_profile/bin/stopNode.sh
/opt/IBM/WebSphere/profiles/wp_profile/bin/syncNode.sh ${DMGR_HOST_NAME} 8879 -restart

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    start-portal-server

Log on to Digital Experience Portal.
Go to Web Content Authoring.
Under Preferences, select Edit Shared Settings.
Under Library Selection, add Web Resources v70 to the Selected Libraries list.
Click OK.
Under Item Views, select All Items > All > Components > JSP.
Select every JSP component from the Web Resources v70 library and then click Edit.
Update the Path field for every JSP component with the new context root path.
The JSP path includes two parts, which are separated by a semi-colon. The first part is the context path to the HCL Web Content Manager extensions web application and then the second part is the path to the JSP. Update the path to the web application.
For example, the other path might be: /wcmextension;/jsp/html/general/UpdateItem.jsp. If you changed the context root to mynewcontext, change the old path to /mynewcontext/wcmextension;/jsp/html/general/UpdateItem.jsp.

Log on to Digital Experience Portal as the administrator.
Open the Manage Search portlet.
Click Search Collections.
Click the search collection that you want to update. For example: Default Search Collection.
Start the Digital Experience Portal crawler content source for each collection:
If the documents are not stored in the search collection but a schedule is defined for the crawler, the crawler automatically runs at the scheduled time. You can also start the crawler manually.
If the documents are already collected, select Regather documents to update the documents with the new context root information.
Click Collections from All Services in the breadcrumb trail and select the next search collection to modify.

Resync:

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    stop-portal-server

/opt/IBM/WebSphere/profiles/wp_profile/bin/stopNode.sh
/opt/IBM/WebSphere/profiles/wp_profile/bin/syncNode.sh ${DMGR_HOST_NAME} 8879 -restart

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    start-portal-server

CHECKPOINT

Deployment Manager:
mkdir -pv /opt/IBM/backups

/opt/IBM/WebSphere/profiles/dmgr01/bin/stopManager.sh

rm -rf /opt/IBM/WebSphere/profiles/dmgr01/temp/*
rm -rf /opt/IBM/WebSphere/profiles/dmgr01/wstemp/*

/opt/IBM/WebSphere/profiles/dmgr01/bin/clearClassCache.sh
/opt/IBM/WebSphere/profiles/dmgr01/bin/osgiCfgInit.sh

/opt/IBM/WebSphere/AppServer/bin/manageprofiles.sh -backupProfile -profileName dmgr01 -backupFile /opt/IBM/backups/dmgr01-backup-PostURIChange-$(date +"%d-%m-%Y_%H:%M:%S");
tar -C /opt/IBM -cvf - ./WebSphere | gzip > /opt/IBM/backups/WebSphere-full-backup-PostURIChange-$(date +"%d-%m-%Y_%H:%M:%S").tar.gz

/opt/IBM/WebSphere/profiles/dmgr01/bin/startManager.sh

Portal node:
mkdir -pv /opt/IBM/backups;

/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/stopServer.sh server1
/opt/IBM/WebSphere/profiles/wp_profile/bin/stopServer.sh WebSphere_Portal
/opt/IBM/WebSphere/profiles/wp_profile/bin/stopNode.sh

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    cleanup-work-dir

/opt/IBM/WebSphere/profiles/wp_profile/ConfigEngine/ConfigEngine.sh \
    delete-passwords

rm -rf /opt/IBM/WebSphere/profiles/wp_profile/temp/*
rm -rf /opt/IBM/WebSphere/profiles/wp_profile/wstemp/*

/opt/IBM/WebSphere/profiles/wp_profile/bin/clearClassCache.sh
/opt/IBM/WebSphere/profiles/wp_profile/bin/osgiCfgInit.sh

rm -rf /opt/IBM/WebSphere/AppServer/profiles/cw_profile/temp/*
rm -rf /opt/IBM/WebSphere/AppServer/profiles/cw_profile/wstemp/*

/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/clearClassCache.sh
/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/osgiCfgInit.sh

for profile in cw_profile wp_profile; do
    /opt/IBM/WebSphere/AppServer/bin/manageprofiles.sh -backupProfile -profileName ${profile} -backupFile /opt/IBM/backups/${profile}-PostURIChange-backup.$(date +"%d-%m-%Y_%H:%M:%S");
done

tar -C /opt/IBM -cvf - ./WebSphere | gzip > /opt/IBM/backups/WebSphere-full-backup-PostURIChange-$(date +"%d-%m-%Y_%H:%M:%S").tar.gz

/opt/IBM/WebSphere/AppServer/profiles/cw_profile/bin/startServer.sh server1
/opt/IBM/WebSphere/profiles/wp_profile/bin/startNode.sh
/opt/IBM/WebSphere/profiles/wp_profile/bin/startServer.sh WebSphere_Portal

Setup Global Security via LDAP

